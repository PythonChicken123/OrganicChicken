var Mailcheck = {
    domainThreshold: 2,
    secondLevelThreshold: 2,
    topLevelThreshold: 2,
    defaultDomains: ["msn.com", "bellsouth.net", "telus.net", "comcast.net", "optusnet.com.au", "earthlink.net", "qq.com", "sky.com", "icloud.com", "mac.com", "sympatico.ca", "googlemail.com", "att.net", "xtra.co.nz", "web.de", "cox.net", "gmail.com", "ymail.com", "aim.com", "rogers.com", "verizon.net", "rocketmail.com", "google.com", "optonline.net", "sbcglobal.net", "aol.com", "me.com", "btinternet.com", "charter.net", "shaw.ca"],
    defaultSecondLevelDomains: ["yahoo", "hotmail", "mail", "live", "outlook", "gmx"],
    defaultTopLevelDomains: ["com", "com.au", "com.tw", "ca", "co.nz", "co.uk", "de", "fr", "it", "ru", "net", "org", "edu", "gov", "jp", "nl", "kr", "se", "eu", "ie", "co.il", "us", "at", "be", "dk", "hk", "es", "gr", "ch", "no", "cz", "in", "net", "net.au", "info", "biz", "mil", "co.jp", "sg", "hu"],
    run: function(c) {
        c.domains = c.domains || Mailcheck.defaultDomains;
        c.secondLevelDomains = c.secondLevelDomains || Mailcheck.defaultSecondLevelDomains;
        c.topLevelDomains = c.topLevelDomains || Mailcheck.defaultTopLevelDomains;
        c.distanceFunction = c.distanceFunction || Mailcheck.sift3Distance;
        var e = function(f) {
            return f
        };
        var b = c.suggested || e;
        var d = c.empty || e;
        var a = Mailcheck.suggest(Mailcheck.encodeEmail(c.email), c.domains, c.secondLevelDomains, c.topLevelDomains, c.distanceFunction);
        return a ? b(a) : d()
    },
    suggest: function(h, j, g, d, c) {
        h = h.toLowerCase();
        var f = this.splitEmail(h);
        if (g && d) {
            if (g.indexOf(f.secondLevelDomain) !== -1 && d.indexOf(f.topLevelDomain) !== -1) {
                return false
            }
        }
        var b = this.findClosestDomain(f.domain, j, c, this.domainThreshold);
        if (b) {
            if (b == f.domain) {
                return false
            } else {
                return {
                    address: f.address,
                    domain: b,
                    full: f.address + "@" + b
                }
            }
        }
        var e = this.findClosestDomain(f.secondLevelDomain, g, c, this.secondLevelThreshold);
        var i = this.findClosestDomain(f.topLevelDomain, d, c, this.topLevelThreshold);
        if (f.domain) {
            var b = f.domain;
            var a = false;
            if (e && e != f.secondLevelDomain) {
                b = b.replace(f.secondLevelDomain, e);
                a = true
            }
            if (i && i != f.topLevelDomain) {
                b = b.replace(f.topLevelDomain, i);
                a = true
            }
            if (a == true) {
                return {
                    address: f.address,
                    domain: b,
                    full: f.address + "@" + b
                }
            }
        }
        return false
    },
    findClosestDomain: function(g, b, d, a) {
        a = a || this.topLevelThreshold;
        var h;
        var e = 99;
        var c = null;
        if (!g || !b) {
            return false
        }
        if (!d) {
            d = this.sift3Distance
        }
        for (var f = 0; f < b.length; f++) {
            if (g === b[f]) {
                return g
            }
            h = d(g, b[f]);
            if (h < e) {
                e = h;
                c = b[f]
            }
        }
        if (e <= a && c !== null) {
            return c
        } else {
            return false
        }
    },
    sift3Distance: function(f, b) {
        if (f == null || f.length === 0) {
            if (b == null || b.length === 0) {
                return 0
            } else {
                return b.length
            }
        }
        if (b == null || b.length === 0) {
            return f.length
        }
        var j = 0;
        var h = 0;
        var g = 0;
        var a = 0;
        var e = 5;
        while ((j + h < f.length) && (j + g < b.length)) {
            if (f.charAt(j + h) == b.charAt(j + g)) {
                a++
            } else {
                h = 0;
                g = 0;
                for (var d = 0; d < e; d++) {
                    if ((j + d < f.length) && (f.charAt(j + d) == b.charAt(j))) {
                        h = d;
                        break
                    }
                    if ((j + d < b.length) && (f.charAt(j) == b.charAt(j + d))) {
                        g = d;
                        break
                    }
                }
            }
            j++
        }
        return (f.length + b.length) / 2 - a
    },
    splitEmail: function(b) {
        var f = b.trim().split("@");
        if (f.length < 2) {
            return false
        }
        for (var c = 0; c < f.length; c++) {
            if (f[c] === "") {
                return false
            }
        }
        var e = f.pop();
        var g = e.split(".");
        var d = "";
        var a = "";
        if (g.length == 0) {
            return false
        } else {
            if (g.length == 1) {
                a = g[0]
            } else {
                d = g[0];
                for (var c = 1; c < g.length; c++) {
                    a += g[c] + "."
                }
                a = a.substring(0, a.length - 1)
            }
        }
        return {
            topLevelDomain: a,
            secondLevelDomain: d,
            domain: e,
            address: f.join("@")
        }
    },
    encodeEmail: function(b) {
        var a = encodeURI(b);
        a = a.replace("%20", " ").replace("%25", "%").replace("%5E", "^").replace("%60", "`").replace("%7B", "{").replace("%7C", "|").replace("%7D", "}");
        return a
    }
};
if (typeof module !== "undefined" && module.exports) {
    module.exports = Mailcheck
}
if (typeof define === "function" && define.amd) {
    define("mailcheck", [], function() {
        return Mailcheck
    })
}
if (typeof window !== "undefined" && window.jQuery) {
    (function(a) {
        a.fn.mailcheck = function(e) {
            var b = this;
            if (e.suggested) {
                var d = e.suggested;
                e.suggested = function(f) {
                    d(b, f)
                }
            }
            if (e.empty) {
                var c = e.empty;
                e.empty = function() {
                    c.call(null, b)
                }
            }
            e.email = this.val();
            Mailcheck.run(e)
        }
    })(jQuery)
};